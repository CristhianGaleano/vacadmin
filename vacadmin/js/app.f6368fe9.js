(function(e){function t(t){for(var n,i,c=t[0],s=t[1],u=t[2],d=0,f=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);l&&l(t);while(f.length)f.shift()();return o.push.apply(o,u||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],n=!0,c=1;c<a.length;c++){var s=a[c];0!==r[s]&&(n=!1)}n&&(o.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},r={app:0},o=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://www.ucp.edu.co/apps/vacadmin/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("8a23"),r=a.n(n);r.a},"4dc0":function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[a("div",{staticClass:"d-flex align-center"},[a("v-toolbar-title",{staticClass:"headline monster-font"},[e._v(" Ventanilla Académica ")])],1),a("v-chip",{staticClass:"ml-3",attrs:{color:"secondary"}},[a("v-avatar",{attrs:{left:""}},[a("v-icon",[e._v("forum")])],1),e._v("Contacto en línea")],1),a("v-spacer"),e.usuario?a("v-layout",{attrs:{"align-center":"","justify-end":""}},[a("v-avatar",{attrs:{size:"40",color:"white"}},[a("v-img",{attrs:{src:e.usuario.foto}})],1),a("span",{staticClass:"ml-1\n       monster-font"},[e._v(e._s(e.usuario.nombre))]),a("v-btn",{staticClass:"monster-font ml-4",attrs:{small:""},on:{click:e.callLogout}},[e._v("Salir")])],1):e._e()],1),a("v-content",[a("v-container",{staticClass:"fondo",attrs:{fluid:"","fill-height":""}},[a("Login",{directives:[{name:"show",rawName:"v-show",value:!e.usuario,expression:"!usuario"}],ref:"childRef",on:{onNotificacion:e.mostrarNotificacion,onIngresar:e.ingresar}}),e.usuario?a("Chat",{attrs:{usuario:e.usuario},on:{onNotificacion:e.mostrarNotificacion}}):e._e()],1)],1),a("v-snackbar",{attrs:{color:e.notificacion.color,"multi-line":"",top:"",timeout:6e3,dark:""},model:{value:e.notificacion.visible,callback:function(t){e.$set(e.notificacion,"visible",t)},expression:"notificacion.visible"}},[a("span",[e._v(e._s(e.notificacion.mensaje))]),a("v-btn",{attrs:{color:"white",text:""},on:{click:function(t){e.notificacion.visible=!1}}},[e._v(" Cerrar ")])],1),a("v-footer",{attrs:{color:"primary dark"}},[a("v-layout",{attrs:{"justify-center":""}},[a("span",[e._v("Universidad Católica de Pereira - Oficina de Comunicaciones - 2020")])])],1)],1)},o=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-layout",{attrs:{"justify-center":"","align-center":""}},[a("v-flex",{attrs:{xs12:"",sm8:"",md6:"",lg5:"",xl4:""}},[a("v-card",[a("v-toolbar",{attrs:{color:"primary",dark:""}},[a("v-toolbar-title",[e._v(" Ingresa tu email y contraseña ")])],1),a("v-card-text",[a("v-text-field",{attrs:{autofocus:"",label:"email"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("v-text-field",{attrs:{label:"Password",type:"password"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.ingresar(t)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),a("v-card-text",[a("v-layout",{attrs:{"justify-end":""}},[a("v-btn",{attrs:{color:"secondary"},on:{click:e.ingresar}},[e._v("Ingresar")])],1)],1)],1)],1)],1)},c=[],s=(a("96cf"),a("1da1")),u=a("c23d"),l=a.n(u);a("ea7b"),a("e71f"),a("588e");var d={apiKey:"AIzaSyD8iB3LmsMdkmY4PnIHrDY1lxvp55N9xHk",authDomain:"chat-ucp.firebaseapp.com",databaseURL:"https://chat-ucp.firebaseio.com",projectId:"chat-ucp",storageBucket:"chat-ucp.appspot.com",messagingSenderId:"240210462109",appId:"1:240210462109:web:86c5069e720e6b3b459b74"};l.a.initializeApp(d);var f=l.a.auth(),v=l.a.firestore(),p=(l.a.storage(),{data:function(){return{email:"",password:""}},methods:{executeLogout:function(){f.signOut().then((function(){console.log("logout succesful")})).catch((function(e){console.log(e)}))},ingresar:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.email){t.next=3;break}return e.enviarNotificacion("Debes indicar un email","Warning"),t.abrupt("return");case 3:if(e.password){t.next=6;break}return e.enviarNotificacion("Debes indicar un password","Warning"),t.abrupt("return");case 6:return t.prev=6,t.next=9,f.signInWithEmailAndPassword(e.email,e.password);case 9:if(!f.currentUser){t.next=15;break}return a=f.currentUser.uid,t.next=13,v.collection("usuarios").doc(a).get();case 13:n=t.sent,n.exists?(r=n.data(),e.$emit("onIngresar",r)):e.enviarNotificacion("No se encontró la información del usuario","Error");case 15:t.next=25;break;case 17:t.prev=17,t.t0=t["catch"](6),t.t1=t.t0.code,t.next="auth/user-not-fond"===t.t1||"auth/wrong-password"===t.t1?22:24;break;case 22:return e.enviarNotificacion("Usuario no válido. Revisa tu correo y contraseña","Warning"),t.abrupt("break",25);case 24:e.enviarNotificacion("Ocurrió un error verificando la información","Error ");case 25:case"end":return t.stop()}}),t,null,[[6,17]])})))()},enviarNotificacion:function(e,t){this.$emit("onNotificacion",{mensaje:e,color:t})}}}),h=p,m=a("2877"),b=a("6544"),g=a.n(b),x=a("8336"),y=a("b0af"),j=a("99d9"),w=a("0e8f"),k=a("a722"),C=a("8654"),_=a("71d9"),V=a("2a7f"),S=Object(m["a"])(h,i,c,!1,null,null,null),M=S.exports;g()(S,{VBtn:x["a"],VCard:y["a"],VCardText:j["a"],VFlex:w["a"],VLayout:k["a"],VTextField:C["a"],VToolbar:_["a"],VToolbarTitle:V["a"]});var L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-layout",{directives:[{name:"resize",rawName:"v-resize",value:e.onResize,expression:"onResize"}]},[e.mostrarLista?a("v-flex",{staticClass:"usuarios",attrs:{xs12:"",sm4:"",lg4:""}},[a("v-card",[a("v-toolbar",{attrs:{color:"primary",dark:"",dense:""}},[a("v-toolbar-title",[e._v(" Contactos ")])],1),a("v-list",{staticClass:"pa-0 ma-0 scroll-y overflow-y-auto",staticStyle:{"max-height":"640px"},attrs:{"two-line":"",id:"scroll-target"}},[e._l(e.usuarios,(function(t){return[a("v-list-item",{key:t.uid,attrs:{value:e.usuarioSeleccionado&&e.usuarioSeleccionado.uid==t.uid,"active-class":"usuario-seleccionado"},on:{click:function(a){return e.seleccionarUsuario(t)}}},[a("v-list-item-avatar",{attrs:{size:"40"}},[a("v-img",{attrs:{src:t.foto}})],1),a("v-list-item-content",[a("v-list-item-title",{staticClass:"monster-font",domProps:{innerHTML:e._s(t.nombre)}}),a("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.ultimoMensaje)}})],1),t.cantidadMensajes>0?a("v-list-item-action",[a("v-badge",{attrs:{color:"primary",overlap:""}},[a("span",{attrs:{slot:"badge"},slot:"badge"},[e._v(e._s(t.cantidadMensajes))])])],1):e._e()],1)]}))],2)],1)],1):e._e(),e.mostrarChat?a("v-flex",{attrs:{xs12:"",sm8:"",lg5:""}},[a("v-container",{staticClass:"pa-0 ma-0",attrs:{"fill-height":""}},[a("v-layout",{attrs:{"align-end":""}},[a("v-flex",[a("v-card",{class:e.mostrarLista?"ml-3":"ml-0",attrs:{color:"#f7faff"}},[a("v-toolbar",{attrs:{color:"primary card dense dark"}},[a("v-toolbar-title",[a("v-icon",{staticClass:"mr-2",on:{click:e.regresar}},[e._v("arrow_back")]),a("v-avatar",{attrs:{color:"white",size:"32"}},[a("v-img",{attrs:{src:e.usuarioSeleccionado.foto}})],1),a("span",{staticClass:"ml-3",attrs:{"monster-font":""}},[e._v(e._s(e.usuarioSeleccionado.nombre))])],1)],1),a("v-container",{ref:"chatContainer",staticClass:"pa-0 ma-0 scroll-y overflow-y-auto",staticStyle:{"max-height":"640px"},attrs:{id:"scroll-target"}},[a("v-card-text",{directives:[{name:"scroll",rawName:"v-scroll:#scroll-target",value:e.onScroll,expression:"onScroll",arg:"#scroll-target"}],style:"max-height: "+e.height+"px;"},e._l(e.chat,(function(t){return a("v-flex",{key:t.mid,staticClass:"my-3",attrs:{xs7:"","offset-xs5":t.uid==e.usuario.uid}},[a("v-layout",{attrs:{column:""}},[a("div",{staticClass:"chat-fecha"},[e._v(e._s(e.convertirFecha(t.fechaEnvio)))]),a("v-card",{staticClass:"chat-mensaje",attrs:{color:t.uid!=e.usuario.uid?"white":"#c3d9ff",elevation:"1"}},[a("v-card-text",[a("div",[e._v(e._s(t.texto))])])],1)],1)],1)})),1)],1),a("v-card-text",[a("v-text-field",{ref:"txtMensaje",attrs:{loading:e.enviandoMensaje,disabled:e.enviandoMensaje,"hide-details":"",label:"Escribe un mensaje"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enviarMensaje(t)}},model:{value:e.mensaje,callback:function(t){e.mensaje=t},expression:"mensaje"}})],1)],1)],1)],1)],1)],1):e._e()],1)},O=[],I=(a("99af"),a("7db0"),a("4160"),a("ac1f"),a("5319"),a("159b"),a("c64e")),N=a.n(I),T={props:["usuario"],data:function(){return{usuarios:[],usuarioSeleccionado:null,chat:[],mensaje:"",enviandoMensaje:!1,cid:null,detenerChat:null,height:0}},computed:{esMovil:function(){return this.$vuetify.breakpoint.width<600},mostrarLista:function(){return this.usuarios&&(!this.esMovil||!this.usuarioSeleccionado)},mostrarChat:function(){return this.usuarios&&this.usuarioSeleccionado}},created:function(){this.consultarUsuarios()},methods:{convertirFecha:function(e){return e.toDate().toISOString().substring(0,16).replace("T"," ")},consultarChat:function(){var e=this;console.log("consultando chat"),this.chat=[],this.detenerChat&&this.detenerChat(),this.detenerChat=v.collection("contactos").doc(this.cid).collection("chat").orderBy("fechaEnvio").onSnapshot((function(t){t.docChanges().forEach((function(t){if("added"===t.type){var a=t.doc.data();e.chat.push(a),a.fechaLeido||a.uid==e.usuario.uid||e.marcarMensajeLeido(a)}e.$nextTick((function(){e.$refs.chatContainer&&(e.$refs.chatContainer.scrollTop=1e5)}))}))}),(function(){e.enviarNotificacion("Ocurrió un error recuperando los mensajes","error")}))},marcarMensajeLeido:function(e){var t=v.batch();t.update(v.collection("contactos").doc(this.cid).collection("chat").doc(e.mid),{fechaLeido:new Date}),console.log("Mensaje leido"),t.delete(v.collection("usuarios").doc(this.usuario.uid).collection("chat-sin-leer").doc(e.mid)),t.commit()},consultarUsuarios:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,v.collection("usuarios").orderBy("lastSignInTime").onSnapshot((function(t){t.docChanges().forEach((function(t){var a=t.doc.data();switch(t.type){case"added":a.uid!=e.usuario.uid&&"user"==a.rol&&(a.cantidadMensajes=0,a.ultimoMensaje="",e.usuarios.push(a)),e.consultarChatSinLeer();break}}))}),(function(){e.enviarNotificacion("Ocurrió un error al consultar la lista de usuarios","error")}));case 2:case"end":return t.stop()}}),t)})))()},consultarChatSinLeer:function(){var e=this;v.collection("usuarios").doc(this.usuario.uid).collection("chat-sin-leer").orderBy("fechaEnvio").onSnapshot((function(t){t.docChanges().forEach((function(t){var a=t.doc.data(),n=e.usuarios.find((function(e){return e.uid==a.uid}));if(n)switch(t.type){case"added":console.log("A adde chat sin leer, change is: ",t.type),n.cantidadMensajes++,n.ultimoMensaje=a.texto;break;case"removed":console.log("R adde chat sin leer, change is: ",t.type),n.cantidadMensajes--,n.ultimoMensaje="",n.cantidadMensajes<0&&(n.cantidadMensajes=0);break}}))}),(function(){e.enviarNotificacion("Ocurrió un error recuperando mensajes sin leer","error")}))},enviarNotificacion:function(e,t){this.$emit("onNotificacion",{mensaje:e,color:t})},generarChatId:function(e,t){return e<t?"".concat(e,"-").concat(t):"".concat(t,"-").concat(e)},seleccionarUsuario:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.cid=t.generarChatId(t.usuario.uid,e.uid),a.prev=1,a.next=4,v.collection("contactos").doc(t.cid).get();case 4:if(n=a.sent,n.exists){a.next=8;break}return a.next=8,v.collection("contactos").doc(t.cid).set({cid:t.cid});case 8:t.usuarioSeleccionado=e,t.consultarChat(),a.next=15;break;case 12:a.prev=12,a.t0=a["catch"](1),t.enviarNotificacion("Ocurrió un error recuperando la información","error");case 15:case"end":return a.stop()}}),a,null,[[1,12]])})))()},regresar:function(){this.usuarioSeleccionado=null},enviarMensaje:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.mensaje&&!e.enviandoMensaje){t.next=2;break}return t.abrupt("return");case 2:return e.enviandoMensaje=!0,a=N()(),n={mid:a,texto:e.mensaje,fechaEnvio:new Date,uid:e.usuario.uid},r=v.batch(),r.set(v.collection("contactos").doc(e.cid).collection("chat").doc(a),n),r.set(v.collection("usuarios").doc(e.usuarioSeleccionado.uid).collection("chat-sin-leer").doc(a),n),t.prev=8,t.next=11,r.commit();case 11:e.mensaje="",t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](8),e.enviarNotificacion("Ocurrió un error enviando el mensaje. Intentalo de nuevo","error");case 17:return t.prev=17,e.enviandoMensaje=!1,e.$refs.txtMensaje.focus(),t.finish(17);case 21:case"end":return t.stop()}}),t,null,[[8,14,17,21]])})))()},onResize:function(){this.height=window.innerHeight-150}}},F=T,R=(a("f196"),a("8212")),E=a("4ca6"),P=a("a523"),$=a("132d"),A=a("adda"),z=a("8860"),B=a("da13"),U=a("1800"),D=a("8270"),H=a("5d23"),W=a("269a"),J=a.n(W),Y=a("dc22"),K=a("f977"),q=Object(m["a"])(F,L,O,!1,null,null,null),G=q.exports;g()(q,{VAvatar:R["a"],VBadge:E["a"],VCard:y["a"],VCardText:j["a"],VContainer:P["a"],VFlex:w["a"],VIcon:$["a"],VImg:A["a"],VLayout:k["a"],VList:z["a"],VListItem:B["a"],VListItemAction:U["a"],VListItemAvatar:D["a"],VListItemContent:H["a"],VListItemSubtitle:H["b"],VListItemTitle:H["c"],VTextField:C["a"],VToolbar:_["a"],VToolbarTitle:V["a"]}),J()(q,{Resize:Y["a"],Scroll:K["b"]});var Q={name:"App",components:{Login:M,Chat:G},data:function(){return{usuario:null,notificacion:{mensaje:"",color:"info",visible:!1}}},created:function(){},methods:{ingresar:function(e){this.usuario=e,console.log("IN-User login: ",e)},mostrarNotificacion:function(e){this.notificacion.mensaje=e.mensaje,this.notificacion.color=e.color,this.notificacion.visible=!0},callLogout:function(){this.$refs.childRef.executeLogout(),this.usuario=null}}},X=Q,Z=(a("034f"),a("7496")),ee=a("40dc"),te=a("cc20"),ae=a("a75b"),ne=a("553a"),re=a("2db4"),oe=a("2fa4"),ie=Object(m["a"])(X,r,o,!1,null,null,null),ce=ie.exports;g()(ie,{VApp:Z["a"],VAppBar:ee["a"],VAvatar:R["a"],VBtn:x["a"],VChip:te["a"],VContainer:P["a"],VContent:ae["a"],VFooter:ne["a"],VIcon:$["a"],VImg:A["a"],VLayout:k["a"],VSnackbar:re["a"],VSpacer:oe["a"],VToolbarTitle:V["a"]});var se=a("f309"),ue=a("2e15"),le=a.n(ue);n["a"].use(se["a"]);var de=new se["a"]({theme:{options:{customProperties:!0},themes:{light:{primary:"#007642",secondary:"#01B163",infoPublicidad:"#F5F5F5",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"}}},lang:{locales:{es:le.a},current:"es"},icons:{iconfont:"md"}});a("d5e8"),a("d1e78");n["a"].config.productionTip=!0,new n["a"]({vuetify:de,render:function(e){return e(ce)}}).$mount("#app")},"8a23":function(e,t,a){},f196:function(e,t,a){"use strict";var n=a("4dc0"),r=a.n(n);r.a}});
//# sourceMappingURL=app.f6368fe9.js.map